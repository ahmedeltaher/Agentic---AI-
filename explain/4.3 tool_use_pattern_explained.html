<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شرح Tool Use Pattern في Agentic AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .card-title {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #00b894;
            padding-bottom: 10px;
        }

        .card-content {
            line-height: 1.8;
            color: #333;
            font-size: 1.1rem;
        }

        .code-card {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            direction: ltr;
            text-align: left;
        }

        .code-card pre {
            overflow-x: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .highlight {
            background: linear-gradient(120deg, #81ecec 0%, #74b9ff 100%);
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
        }

        .process-step {
            background: #f8f9fa;
            border-left: 5px solid #00b894;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
        }

        .important-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .important-note::before {
            content: "💡 ";
            font-size: 1.5rem;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .example-item {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #27ae60;
        }

        .arabic-text {
            direction: rtl;
            text-align: right;
        }

        .ltr-text {
            direction: ltr;
            text-align: left;
        }

        .tool-comparison {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .tool-comparison h3 {
            margin-bottom: 15px;
            font-size: 1.5rem;
            text-align: center;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .comparison-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .tool-workflow {
            background: #6c5ce7;
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .workflow-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .workflow-step {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .step-number {
            background: #fdcb6e;
            color: #2d3436;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .tool-types {
            background: #fd79a8;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .tool-types ul {
            margin: 15px 0;
            padding-right: 20px;
        }

        .tool-types li {
            margin: 10px 0;
            font-size: 1.1rem;
        }

        .parameter-section {
            background: #a29bfe;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .decision-matrix {
            background: #00b894;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .decision-matrix h3 {
            margin-bottom: 15px;
        }

        .decision-flow {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .decision-box {
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 8px;
            min-width: 120px;
        }

        .arrow-right {
            font-size: 1.5rem;
            color: #fdcb6e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🛠️ شرح Tool Use Pattern في Agentic AI</h1>
            <p>أشهر وأهم نمط في الذكاء الاصطناعي التفاعلي</p>
        </div>

        <div class="card">
            <h2 class="card-title">🎯 إيه هو Tool Use Pattern؟</h2>
            <div class="card-content arabic-text">
                <p>تخيل إنك نجار ماهر عندك صندوق أدوات مليان بأدوات مختلفة. لكل مشروع، إنت بتختار الأداة المناسبة وتستخدمها بالطريقة الصحيحة. ده بالضبط اللي بيحصل في Tool Use Pattern!</p>
                
                <br>
                
                <p>ده <span class="highlight">أشهر نمط في Agentic AI</span> على الإطلاق! النمط ده بيخلي الـ LLM يقرر متى وإزاي يستخدم الأدوات المختلفة المتاحة له.</p>
                
                <br>
                
                <p>الفرق هنا إن الـ LLM مش بس بيختار الأداة، ده كمان بيحدد <span class="highlight">المعاملات والمدخلات</span> اللي محتاجها الأداة دي علشان تشتغل صح!</p>

                <div class="tool-comparison">
                    <h3>🔄 Tool Use vs Router Pattern</h3>
                    <div class="comparison-grid">
                        <div class="comparison-item">
                            <strong>🚦 Router Pattern</strong>
                            <p>يختار الطريق أو الـ Action</p>
                            <p>قرار بسيط: أي طريق؟</p>
                        </div>
                        <div class="comparison-item">
                            <strong>🛠️ Tool Use Pattern</strong>
                            <p>يختار الأداة + المعاملات</p>
                            <p>قرار مركب: أي أداة؟ وإزاي؟</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">⚙️ إزاي بيشتغل Tool Use Pattern؟</h2>
            <div class="card-content arabic-text">
                <p>الأدوات في النمط ده زي الـ Actions في Router، بس مع إضافة مهمة:</p>

                <div class="tool-types">
                    <h3>🧰 أنواع الأدوات المتاحة:</h3>
                    <ul>
                        <li><strong>🗄️ مصادر البيانات:</strong> قواعد بيانات، APIs، ملفات</li>
                        <li><strong>⚡ الدوال والوظائف:</strong> حسابات، معالجة، تحليل</li>
                        <li><strong>🔍 تقنيات الاسترجاع:</strong> البحث، الفهرسة، الترتيب</li>
                        <li><strong>🔗 تكاملات الأنظمة:</strong> ربط مع خدمات خارجية</li>
                    </ul>
                </div>

                <div class="parameter-section">
                    <h3>📋 معاملات الأدوات (Parameters)</h3>
                    <p>كل أداة محتاجة معلومات محددة علشان تشتغل:</p>
                    <ul>
                        <li><strong>نوع البيانات المطلوبة</strong></li>
                        <li><strong>قيم المعاملات</strong></li>
                        <li><strong>خيارات التكوين</strong></li>
                        <li><strong>شروط التشغيل</strong></li>
                    </ul>
                </div>

                <div class="important-note">
                    <strong>الفرق الكبير:</strong> الـ LLM مش بس بيختار الأداة، ده كمان بيحدد القيم المطلوبة للمعاملات من السياق أو من الهدف نفسه!
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">🔄 خطوات Tool Use Pattern</h2>
            <div class="card-content arabic-text">
                <div class="tool-workflow">
                    <h3>🎯 سير العمل الكامل</h3>
                    <div class="workflow-steps">
                        <div class="workflow-step">
                            <div class="step-number">1</div>
                            <div>
                                <strong>استقبال الهدف</strong>
                                <p>الـ Agent ياخد الهدف من المستخدم</p>
                            </div>
                        </div>
                        <div class="workflow-step">
                            <div class="step-number">2</div>
                            <div>
                                <strong>تحليل الهدف</strong>
                                <p>الـ LLM يحلل الهدف ويفهم المطلوب</p>
                            </div>
                        </div>
                        <div class="workflow-step">
                            <div class="step-number">3</div>
                            <div>
                                <strong>اختيار الأدوات</strong>
                                <p>يقرر أي أدوات محتاجة وبأي ترتيب</p>
                            </div>
                        </div>
                        <div class="workflow-step">
                            <div class="step-number">4</div>
                            <div>
                                <strong>استخراج المعاملات</strong>
                                <p>يحدد قيم المعاملات من السياق أو الهدف</p>
                            </div>
                        </div>
                        <div class="workflow-step">
                            <div class="step-number">5</div>
                            <div>
                                <strong>تنفيذ الأدوات</strong>
                                <p>الـ Agent ينفذ الأدوات بالمعاملات المحددة</p>
                            </div>
                        </div>
                        <div class="workflow-step">
                            <div class="step-number">6</div>
                            <div>
                                <strong>معالجة النتائج</strong>
                                <p>يجمع ويعالج نتائج الأدوات المختلفة</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="decision-matrix">
                    <h3>🤔 عملية اتخاذ القرار</h3>
                    <div class="decision-flow">
                        <div class="decision-box">ما الهدف؟</div>
                        <div class="arrow-right">➡️</div>
                        <div class="decision-box">أي أدوات؟</div>
                        <div class="arrow-right">➡️</div>
                        <div class="decision-box">أي معاملات؟</div>
                        <div class="arrow-right">➡️</div>
                        <div class="decision-box">تنفيذ!</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">💻 مثال بالكود: مساعد ذكي للمطورين</h2>
            <div class="card-content arabic-text">
                <p>ده مثال على استخدام Tool Use Pattern في بناء مساعد ذكي للمطورين:</p>
            </div>
            
            <div class="code-card">
                <pre>
class DeveloperAssistantAgent:
    def __init__(self):
        self.llm = LLM()
        self.tools = {
            "search_documentation": {
                "description": "Search for API documentation and code examples",
                "parameters": {
                    "query": "string - search query",
                    "language": "string - programming language", 
                    "api_type": "string - API or framework name"
                },
                "function": self.search_docs
            },
            "analyze_code": {
                "description": "Analyze code for bugs, performance, or best practices",
                "parameters": {
                    "code": "string - code to analyze",
                    "language": "string - programming language",
                    "analysis_type": "string - bugs/performance/style"
                },
                "function": self.analyze_code
            },
            "generate_unit_tests": {
                "description": "Generate unit tests for given code",
                "parameters": {
                    "code": "string - code to test",
                    "language": "string - programming language",
                    "test_framework": "string - testing framework"
                },
                "function": self.generate_tests
            },
            "database_query": {
                "description": "Query database for relevant information",
                "parameters": {
                    "query": "string - SQL query or description",
                    "database_type": "string - database type",
                    "table_name": "string - specific table if known"
                },
                "function": self.query_database
            }
        }
    
    def process_request(self, user_request):
        """
        Main method that implements tool use pattern
        """
        # Step 1: Analyze the request and decide on tools + parameters
        analysis = self.llm.analyze_request(
            request=user_request,
            available_tools=self.tools
        )
        
        print(f"Request: {user_request}")
        print(f"Selected tools: {[tool['name'] for tool in analysis.selected_tools]}")
        
        results = []
        
        # Step 2: Execute tools in sequence
        for tool_usage in analysis.selected_tools:
            tool_name = tool_usage.name
            parameters = tool_usage.parameters
            
            print(f"\nExecuting {tool_name} with parameters: {parameters}")
            
            # Execute the tool
            tool_result = self.tools[tool_name]["function"](**parameters)
            results.append({
                "tool": tool_name,
                "parameters": parameters,
                "result": tool_result
            })
        
        # Step 3: Synthesize final response
        final_response = self.llm.synthesize_response(
            original_request=user_request,
            tool_results=results
        )
        
        return final_response
    
    def search_docs(self, query, language, api_type):
        """
        Search documentation tool
        """
        # Implementation for documentation search
        return f"Found documentation for {query} in {language} ({api_type})"
    
    def analyze_code(self, code, language, analysis_type):
        """
        Code analysis tool
        """
        # Implementation for code analysis
        return f"Analysis complete for {language} code ({analysis_type})"
    
    def generate_tests(self, code, language, test_framework):
        """
        Unit test generation tool
        """
        # Implementation for test generation
        return f"Generated {test_framework} tests for {language} code"
    
    def query_database(self, query, database_type, table_name):
        """
        Database query tool
        """
        # Implementation for database querying
        return f"Queried {database_type} database, table: {table_name}"

# Example usage
agent = DeveloperAssistantAgent()

# Example 1: Complex request requiring multiple tools
request1 = "I have a Python function that seems slow. Can you analyze it and generate tests?"

response1 = agent.process_request(request1)
# LLM will likely choose: analyze_code + generate_unit_tests
# Parameters extracted: language="python", analysis_type="performance", etc.

# Example 2: Documentation search
request2 = "How do I use React hooks for state management?"

response2 = agent.process_request(request2)
# LLM will choose: search_documentation
# Parameters: query="React hooks state management", language="javascript", api_type="React"

print("Response 1:", response1)
print("Response 2:", response2)
                </pre>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">🎯 استخراج المعاملات (Parameter Extraction)</h2>
            <div class="card-content arabic-text">
                <p>ده الجزء الأذكى في Tool Use Pattern - إزاي الـ LLM يستخرج المعاملات المطلوبة:</p>

                <div class="examples-grid">
                    <div class="example-item">
                        <strong>📝 من النص المباشر</strong>
                        <p>"ابحث عن React hooks" → query="React hooks"</p>
                    </div>
                    <div class="example-item">
                        <strong>🧠 من السياق</strong>
                        <p>إذا كان المطور بيتكلم عن JavaScript → language="javascript"</p>
                    </div>
                    <div class="example-item">
                        <strong>📚 من التاريخ</strong>
                        <p>المحادثات السابقة تحدد preferences المستخدم</p>
                    </div>
                    <div class="example-item">
                        <strong>🎯 من القيم الافتراضية</strong>
                        <p>استخدام قيم منطقية إذا لم تُحدد</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">💻 مثال متقدم: وكيل خدمة عملاء ذكي</h2>
            <div class="card-content arabic-text">
                <p>مثال أكثر تعقيداً يوضح استخدام أدوات متعددة في تسلسل:</p>
            </div>
            
            <div class="code-card">
                <pre>
class SmartCustomerServiceAgent:
    def __init__(self):
        self.llm = LLM()
        self.tools = {
            "lookup_customer": {
                "description": "Find customer information by ID, email, or phone",
                "parameters": {
                    "identifier": "string - customer ID, email, or phone",
                    "identifier_type": "string - id/email/phone"
                },
                "function": self.lookup_customer
            },
            "check_order_status": {
                "description": "Check the status of a customer order",
                "parameters": {
                    "order_id": "string - order identifier",
                    "customer_id": "string - customer identifier"
                },
                "function": self.check_order_status
            },
            "process_refund": {
                "description": "Process a refund for a customer",
                "parameters": {
                    "order_id": "string - order to refund",
                    "amount": "float - refund amount",
                    "reason": "string - reason for refund"
                },
                "function": self.process_refund
            },
            "send_notification": {
                "description": "Send notification to customer",
                "parameters": {
                    "customer_id": "string - customer to notify",
                    "message": "string - notification message",
                    "channel": "string - email/sms/push"
                },
                "function": self.send_notification
            },
            "escalate_to_human": {
                "description": "Escalate complex issues to human agent",
                "parameters": {
                    "issue_type": "string - type of issue",
                    "priority": "string - low/medium/high",
                    "summary": "string - issue summary"
                },
                "function": self.escalate_to_human
            }
        }
    
    def handle_customer_request(self, customer_message, context=None):
        """
        Handle customer service request using tool use pattern
        """
        # Analyze customer message and determine required tools
        analysis = self.llm.analyze_customer_request(
            message=customer_message,
            context=context,
            available_tools=self.tools
        )
        
        print(f"Customer: {customer_message}")
        print(f"Analysis: {analysis.intent}")
        print(f"Tools needed: {[t.name for t in analysis.tool_sequence]}")
        
        execution_results = []
        customer_data = {}
        
        # Execute tools in the determined sequence
        for step, tool_action in enumerate(analysis.tool_sequence):
            print(f"\nStep {step + 1}: Executing {tool_action.name}")
            
            # Dynamic parameter extraction
            parameters = self.extract_parameters(
                tool_action.parameters,
                customer_message,
                customer_data,
                context
            )
            
            print(f"Parameters: {parameters}")
            
            # Execute tool
            result = self.tools[tool_action.name]["function"](**parameters)
            
            # Store result for use in subsequent tools
            execution_results.append(result)
            if tool_action.name == "lookup_customer":
                customer_data = result
            
            print(f"Result: {result}")
        
        # Generate final customer response
        final_response = self.llm.generate_customer_response(
            original_message=customer_message,
            execution_results=execution_results,
            customer_data=customer_data
        )
        
        return final_response
    
    def extract_parameters(self, param_template, message, customer_data, context):
        """
        Extract parameter values from various sources
        """
        extracted = {}
        
        for param_name, param_info in param_template.items():
            if param_name == "customer_id" and customer_data:
                extracted[param_name] = customer_data.get("id")
            elif param_name == "identifier":
                # Extract email, phone, or ID from message
                extracted[param_name] = self.llm.extract_identifier(message)
                extracted["identifier_type"] = self.llm.detect_identifier_type(
                    extracted[param_name]
                )
            elif param_name == "order_id":
                extracted[param_name] = self.llm.extract_order_id(message)
            elif param_name == "reason":
                extracted[param_name] = self.llm.extract_reason(message)
            else:
                # Use LLM to extract other parameters
                extracted[param_name] = self.llm.extract_parameter(
                    param_name, message, context
                )
        
        return extracted
    
    def lookup_customer(self, identifier, identifier_type):
        # Mock implementation
        return {
            "id": "CUST001",
            "name": "أحمد محمد",
            "email": "ahmed@example.com",
            "phone": "+201234567890"
        }
    
    def check_order_status(self, order_id, customer_id):
        # Mock implementation
        return {
            "order_id": order_id,
            "status": "shipped",
            "tracking": "TRK123456",
            "estimated_delivery": "2025-08-12"
        }
    
    def process_refund(self, order_id, amount, reason):
        # Mock implementation
        return {
            "refund_id": "REF789",
            "amount": amount,
            "status": "processed",
            "estimated_days": "3-5"
        }
    
    def send_notification(self, customer_id, message, channel):
        # Mock implementation
        return {"notification_sent": True, "channel": channel}
    
    def escalate_to_human(self, issue_type, priority, summary):
        # Mock implementation
        return {"ticket_id": "TKT456", "assigned_agent": "سارة أحمد"}

# Example usage scenarios
agent = SmartCustomerServiceAgent()

# Scenario 1: Order status inquiry
response1 = agent.handle_customer_request(
    "مرحبا، أريد معرفة حالة طلبي رقم ORD12345، إيميلي ahmed@example.com"
)
# Tools used: lookup_customer, check_order_status

# Scenario 2: Refund request
response2 = agent.handle_customer_request(
    "أريد استرداد قيمة الطلب ORD67890 بسبب عيب في المنتج"
)
# Tools used: lookup_customer, check_order_status, process_refund, send_notification

print("Response 1:", response1)
print("Response 2:", response2)
                </pre>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">🌟 مزايا Tool Use Pattern</h2>
            <div class="card-content arabic-text">
                <div class="tool-types">
                    <h3>🚀 الفوائد الرئيسية:</h3>
                    <ul>
                        <li>🎯 <strong>مرونة عالية:</strong> يقدر يتعامل مع طلبات معقدة ومتنوعة</li>
                        <li>🔧 <strong>استخدام ذكي للأدوات:</strong> يختار الأداة المناسبة تلقائياً</li>
                        <li>📊 <strong>معالجة المعاملات:</strong> يستخرج المعاملات من السياق</li>
                        <li>🔄 <strong>تسلسل الأدوات:</strong> يستخدم عدة أدوات في تسلسل منطقي</li>
                        <li>💡 <strong>ذكاء سياقي:</strong> يفهم السياق ويستفيد منه</li>
                        <li>⚡ <strong>كفاءة عالية:</strong> ينجز مهام معقدة بسرعة</li>
                    </ul>
                </div>

                <div class="important-note">
                    <strong>الاستخدامات الشائعة:</strong> المساعدين الأذكياء، خدمة العملاء، تطوير البرمجيات، تحليل البيانات، والتحكم في الأنظمة المختلفة.
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">🔧 نصائح للتطبيق الناجح</h2>
            <div class="card-content arabic-text">
                <div class="important-note">
                    <strong>وصف دقيق للأدوات:</strong> اكتب وصف مفصل لكل أداة ومعاملاتها علشان الـ LLM يفهم إزاي يستخدمها صح.
                </div>

                <p><strong>🎯 تحديد المعاملات بوضوح:</strong> حدد نوع وشكل كل معامل مطلوب (string, number, boolean, etc.)</p>
                
                <br>
                
                <p><strong>🔄 معالجة الأخطاء:</strong> حط استراتيجية للتعامل مع الأخطاء لما أداة معينة تفشل.</p>
                
                <br>
                
                <p><strong>📚 استخدام السياق:</strong> خلي الـ LLM يستفيد من تاريخ المحادثة لاستخراج المعاملات.</p>
                
                <br>
                
                <p><strong>⚖️ تحسين الأداء:</strong> رتب الأدوات حسب الأولوية وتجنب الاستخدامات غير الضرورية.</p>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">✅ الخلاصة</h2>
            <div class="card-content arabic-text">
                <p>Tool Use Pattern هو أقوى وأشهر نمط في Agentic AI لأنه بيحقق مرونة عالية جداً في التعامل مع المهام المعقدة.</p>
                
                <br>
                
                <p><strong>الفكرة الأساسية:</strong> الـ LLM مش بس بيختار الأداة المناسبة، ده كمان بيحدد إزاي يستخدمها بالضبط!</p>
                
                <div class="decision-matrix">
                    <h3>🎯 العملية في خطوة واحدة:</h3>
                    <p><strong>فهم الهدف ← اختيار الأدوات ← استخراج المعاملات ← التنفيذ ← النتيجة</strong></p>
                </div>
                
                <div class="important-note">
                    <strong>مفتاح النجاح:</strong> أدوات موصوفة بوضوح + معاملات محددة بدقة + LLM ذكي = نظام قادر على أي شيء!
                </div>
            </div>
        </div>
    </div>
</body>
</html>
